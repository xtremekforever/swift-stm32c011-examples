# Support Scripts

This directory contains some scripts to help with using this project. There are some install scripts
to make it easy to install dependencies needed for the project:

- `install-dependencies-ubuntu.sh`: Install the needed packages and the latest `stlink` for Ubuntu.
- `install-dependencies-fedora.sh`: Install the needed packages for Fedora (or RedHat/CentOS).

This directory also contains `stm32c011.svd.patched`, which is the SVD reference file that was patched
as part of the [stm32-rs](https://stm32-rs.github.io/stm32-rs/) project. Other SVD files can be found
there, but we include only the one for the STM32C011 here.

## Using SVD2Swift

In order to generate MMIO register block structures from the SVD file, the `SVD2Swift` utility must be used.
This is included as part of the [swift-mmio](https://github.com/apple/swift-mmio) package, and can be
compiled and run separately. 

```bash
git clone https://github.com/apple/swift-mmio.git
cd swift-mmio
swift build --product SVD2Swift
```

Please note that this requires a Swift toolchain 6.0 or later to build. Back inside of this scripts
directory, run the `SVD2Swift` utility as follows:

```bash
swift-mmio/.build/debug/SVD2Swift -i ./stm32c011.svd.patched -o ./output
```

Then, all the SVD files should be available in the output directory:

```bash
output/
├── ADC.swift
├── CRC.swift
├── DBG.swift
├── Device.swift
├── DMAMUX.swift
├── DMA.swift
├── EXTI.swift
├── GPIOA.swift
├── GPIOB.swift
├── GPIOC.swift
├── GPIOD.swift
├── GPIOF.swift
├── I2C.swift
├── IWDG.swift
├── PWR.swift
├── RCC.swift
├── RTC.swift
├── SPI.swift
├── SYSCFG.swift
├── TIM14.swift
├── TIM16.swift
├── TIM17.swift
├── TIM1.swift
├── TIM3.swift
├── USART1.swift
├── USART2.swift
└── WWDG.swift
```

These can be copied into the project and handpicked depending on what is needed. Remember to remove
unused modules from `Device.swift`:

```swift
// Generated by svd2swift.

import MMIO

/// Analog to Digital Converter
let adc = ADC(unsafeAddress: 0x40012400)

/// Cyclic redundancy check calculation unit
let crc = CRC(unsafeAddress: 0x40023000)

/// DBG register block
let dbg = DBG(unsafeAddress: 0x40015800)

/// DMA controller
let dma = DMA(unsafeAddress: 0x40020000)

/// DMAMUX register block
let dmamux = DMAMUX(unsafeAddress: 0x40020800)

/// EXTI address block description
let exti = EXTI(unsafeAddress: 0x40021800)

/// GPIOA address block description
let gpioa = GPIOA(unsafeAddress: 0x50000000)

/// GPIOB address block description
let gpiob = GPIOB(unsafeAddress: 0x50000400)

/// GPIOC address block description
let gpioc = GPIOC(unsafeAddress: 0x50000800)

/// GPIOD address block description
let gpiod = GPIOD(unsafeAddress: 0x50000c00)

/// GPIOF address block description
let gpiof = GPIOF(unsafeAddress: 0x50001400)

/// I2C register block
let i2c = I2C(unsafeAddress: 0x40005400)

/// IWDG register block
let iwdg = IWDG(unsafeAddress: 0x40003000)

/// PWR address block description
let pwr = PWR(unsafeAddress: 0x40007000)

/// RCC address block description
let rcc = RCC(unsafeAddress: 0x40021000)

/// RTC register block
let rtc = RTC(unsafeAddress: 0x40002800)

/// Serial peripheral interface
let `spi` = SPI(unsafeAddress: 0x40013000)

/// SYSCFG register block
let syscfg = SYSCFG(unsafeAddress: 0x40010000)

/// Advanced-control timer
let tim1 = TIM1(unsafeAddress: 0x40012c00)

/// General-purpose timers
let tim14 = TIM14(unsafeAddress: 0x40002000)

/// General-purpose timers
let tim16 = TIM16(unsafeAddress: 0x40014400)

/// General-purpose timers
let tim17 = TIM17(unsafeAddress: 0x40014800)

/// General-purpose timer
let tim3 = TIM3(unsafeAddress: 0x40000400)

/// USART register block
let usart1 = USART1(unsafeAddress: 0x40013800)

/// USART register block
let usart2 = USART2(unsafeAddress: 0x40004400)

/// WWDG register block
let wwdg = WWDG(unsafeAddress: 0x40002c00)
```
